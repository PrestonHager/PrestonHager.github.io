---
layout: post
title:  "NixOS and Nix (Package Manager)"
date:   2024-09-25 14:19:00 -0600
categories: update
author: Preston Hager
---

After watching ["NixOS: Everything Everywhere All At Once"][1], by No
Boilerplate, I decided to give [NixOS][2] a try. It's definitely a learning
curve, and it's taken awhile for me to get a good configuration going all while
trying to learn the Nix language. There are a few things to meantion about
NixOS. First, Nix is a fully functional programming language. This means that
you can do a lot with Nix that may not immediately be obvious. Second, NixOS is
a declarative, which leads to reproduciblity and even allows for rollbacks
without restarting.

**TL;DR:** NixOS is a deep and rich experience, with a very steep learning
curve. I recommend anyone getting started, try to start with a very simple
config, maybe even building one from scratch. If you want, my current
configurations (at least at the time of writing this) are simple and available
on [GitHub][3].

### Basic File Structure

To start, we need to understand the basic structure of a Nix project. Every
project has some number of `.nix` files which typically look like a weird mix
of JSON, YAML, or other markup languages you might already be familiar with.
Typically, a file such as `default.nix` can be found at the root of a project
directory. Nix, the package manager, will build this file and export a package
which can then be added to the system's environment. In the case of NixOS, the
exported package becomes the entire operating system. Note that sometimes files
such as `build.nix`, or `flake.nix` are used as the "starting point" which we
will see more later. Other than that, your `.nix` files can be named anything!

A fresh installation of NixOS will contain only two `.nix` files:
`configuration.nix` and `hardware-configuration.nix`. Typically you don't need
to modify the `hardware-configuration.nix` file generated by the installer.
However, it's just like any other nix file and can absolutely be modified to the
user's content. Taking a look at `configuration.nix`, the boilerplate might look
something like the following:

```nix
{ config, pkgs, ... }:

{
  imports = [
    # Include the results of the hardware scan.
    ./hardware-configuration.nix
  ];

  # Some miscellaneous boot and network options
  ...

  # List packages installed in system profile. To search, run:
  # $ nix search wget
  environment.systemPackages = with pkgs; [
    wget
  ];
  
  # This value determines the NixOS release with which your system is to be
  # compatible, in order to avoid breaking some software such as database
  # servers. You should change this only after NixOS release notes say you
  # should.
  system.stateVersion = "24.05"; # Did you read the manual?
}
```

The default `configuration.nix` file is fairly self-explanatory. If you end up
reading a lot about Nix or NixOS, you'll see some (possibily) unfamiliar
language with regards to its data types. For example, attrsets versus lists
versus derivations, or nested sets. Have a read through the
[Nix Reference Manual][4] to get a better understanding of these data types.
There's also the [nix.dev tutorial][5] if you prefer a more hands-on approach.

To summarize the data types you'll find in nix most commonly. An attrset, or
just set, is a collection of key-value pairs. The syntax is `{ key = value; }`.
A list is a collection of values. The syntax is `[ value1 value2 value3 ]`.
Note that sets' pairs end in a semicolon (`;`) and lists' values are separated
by whitespace. Past these datatypes, the next most common thing to see (other
than actual strings and integers I suppose) is functions. There are many builtin
functions in nix, included one that can already be spotted in the default
configuration. The `with` function! Although it's a very complex function when
you start to break it down, it can also seem simple once you understand it. Most
commonly, you'll see these functions in the form of `mkSomething` for "make
something". For example, `mkDerivation`, `mkShell`, `mkIf`, etc. These functions
typically take in some set as the argument(s) to create something like a shell
file, or pulling an image, and many more.


### Declarative and Reproduciblity

One of the most powerful features of NixOS is its declarative nature and the
ability to rollback to a previous state without even rebooting. To get starting
playing around with NixOS you only need a few commands. First, building the
current configuration is as simple as running `nixos-rebuild build`.


[1]: https://youtu.be/CwfKlX3rA6E?si=TaJuuXhePWBzN3Iy
[2]: https://nixos.org/
[3]: https://github.com/PrestonHager/nixos-configs/commit/2555165a416dab8d04d0116dee702a765e547390
[4]: https://nix.dev/manual/nix/2.18/language/
[5]: https://nix.dev/tutorials/nix-language
